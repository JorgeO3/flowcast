replicaCount: 2

image:
  repository: varnishcache/varnish
  tag: "7.0" # Ajusta según la versión deseada
  pullPolicy: IfNotPresent

service:
  type: NodePort
  port: 80
  targetPort: 6081

ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: "nginx" # Cambia si usas otro Ingress Controller
  hosts:
    - host: varnish.local
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: varnish
              port:
                number: 80
  tls:
    - hosts:
        - varnish.local
      secretName: varnish-tls

config:
  vcl: |
    vcl 4.0;
    backend default {
      .host = "krakend.api-gateway.svc.cluster.local";
      .port = "8080";
    }

resources:
  limits:
    cpu: "1000m"
    memory: "1Gi"
  requests:
    cpu: "500m"
    memory: "512Mi"

hpa:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 50
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 70
    - type: Pods
      pods:
        metric:
          name: http_requests_per_second
        target:
          type: AverageValue
          averageValue: 200
